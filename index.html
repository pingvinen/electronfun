<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Electron FUN</title>
  </head>
  <body>
    <h1>Electron FUN!</h1>
    We are using node <script>document.write(process.versions.node)</script>,
    Chrome <script>document.write(process.versions.chrome)</script>,
    and Electron <script>document.write(process.versions.electron)</script>.

    <div id="holder">Drag your file here</div>
    <button onclick="pickAndLoadFile()">Load csv file</button>
    <textarea id="fileOutput"></textarea>

    <script>
        const {dialog} = require('electron').remote;
        const fs = require('fs'); // Load the File System to execute our common tasks (CRUD)
        const holder = document.getElementById('holder');

        holder.ondragover = () => {
            return false;
        };

        holder.ondragleave = () => {
            return false;
        };

        holder.ondrop = (e) => {
            e.preventDefault();
            if (e.dataTransfer.files.length > 1) {
                alert('only 1 file at a time');
                return;
            }

            const file = e.dataTransfer.files[0];
            console.log(file);

            if (file.type === 'text/csv') {

            }

            switch (file.type) {
                case 'text/csv':
                case 'text/plain':
                    return loadFile(file.path);
                
                default:
                    alert('Not a csv file');
                    return;
            }
        }


        function pickAndLoadFile() {
            const paths = dialog.showOpenDialog({
                properties: ['openFile'],
                title: 'Select your csv file',
                filters: [
                    { name: 'CSV', extensions: ['csv'] }
                ]
            });
            
            if (paths ===undefined) {
                console.log('no files selected');
                return;
            }

            loadFile(paths[0]);
        }

        function loadFile(path) {
            fs.readFile(path, 'utf-8', (err, data) => {
                if (err) {
                    alert(err.message);
                    return;
                }

                document.getElementById('fileOutput').value = data;
            })
        }
    </script>
  </body>
</html>
